---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';

// Enable server-side rendering for this page to fetch articles
export const prerender = false;

// Fetch real articles from backend
let articles = [];
try {
  const backendUrl = import.meta.env.BACKEND_URL || 'http://localhost:3001';
  const response = await fetch(`${backendUrl}/api/v1/articles?limit=10&sort=recent`);
  
  if (response.ok) {
    const data = await response.json();
    articles = data.articles || [];
  } else {
    console.error('Failed to fetch articles:', response.status);
  }
} catch (error) {
  console.error('Error fetching articles:', error);
  // Fallback to empty array if fetch fails
  articles = [];
}

const formatDate = (dateString: string) => {
  return new Date(dateString).toLocaleDateString('en-US', {
    month: 'short',
    day: 'numeric'
  });
};
---

<Layout title="FastBlog - Fast and Modern Blogging Platform">
  <Header />
  
  <main class="min-h-screen bg-white dark:bg-gray-900">
    <!-- Hero Section - Medium style -->
    <section class="border-b border-gray-200 dark:border-gray-800 py-20 bg-yellow-50 dark:bg-gray-800">
      <div class="max-w-4xl mx-auto px-6">
        <div class="text-left">
          <h1 class="text-6xl md:text-7xl font-bold text-gray-900 dark:text-white mb-6 leading-tight">
            Human<br/>stories & ideas
          </h1>
          <p class="text-xl text-gray-600 dark:text-gray-300 mb-8 max-w-lg">
            A place to read, write, and deepen your understanding
          </p>
          <div class="flex flex-col sm:flex-row gap-4">
            <a href="/write" class="px-12 py-3 bg-gray-900 text-white rounded-full font-medium hover:bg-gray-800 transition-colors">
              Start writing
            </a>
            <a href="/explore" class="px-12 py-3 border border-gray-900 text-gray-900 dark:border-white dark:text-white rounded-full font-medium hover:bg-gray-900 hover:text-white dark:hover:bg-white dark:hover:text-gray-900 transition-colors">
              Start reading
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Articles - Medium style layout -->
    <section class="py-16">
      <div class="max-w-6xl mx-auto px-6">
        <div class="grid lg:grid-cols-3 gap-12">
          <!-- Main content -->
          <div class="lg:col-span-2 space-y-12">
            {articles.length > 0 ? articles.map(article => (
              <article class="group border-b border-gray-100 dark:border-gray-800 pb-8 last:border-b-0">
                <div class="flex items-center space-x-3 mb-4">
                  <img 
                    src={article.author?.avatar_url ? (article.author.avatar_url.startsWith('/') ? `http://localhost:3001${article.author.avatar_url}` : article.author.avatar_url) : '/default-avatar.png'} 
                    alt={article.author?.display_name || article.author?.username}
                    class="w-6 h-6 rounded-full bg-gray-200 dark:bg-gray-700"
                    onError="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDEyQzE0LjIwOTEgMTIgMTYgMTAuMjA5MSAxNiA4QzE2IDUuNzkwODYgMTQuMjA5MSA0IDEyIDRDOS43OTA4NiA0IDggNS43OTA4NiA4IDhDOCAxMC4yMDkxIDkuNzkwODYgMTIgMTIgMTJaTTEyIDEyQzE2IDEyIDIwIDE0IDIwIDIwVjIySDRWMjBDNCA0IDggMTIgMTIgMTJaIiBmaWxsPSIjOTQ5NDk0Ii8+Cjwvc3ZnPgo='"
                  />
                  <span class="text-sm text-gray-700 dark:text-gray-300">
                    {article.author?.display_name || article.author?.username || 'Anonymous'}
                  </span>
                  <span class="text-gray-400 text-sm">·</span>
                  <span class="text-sm text-gray-500 dark:text-gray-400">
                    {formatDate(article.created_at)}
                  </span>
                  <span class="text-gray-400 text-sm">·</span>
                  <span class="text-sm text-gray-500 dark:text-gray-400">
                    {article.reading_time_minutes} min read
                  </span>
                </div>

                <h2 class="text-2xl font-bold text-gray-900 dark:text-white leading-tight mb-3 group-hover:text-gray-700 dark:group-hover:text-gray-300 transition-colors">
                  <a href={`/article/${article.slug}`}>
                    {article.title}
                  </a>
                </h2>

                <p class="text-gray-600 dark:text-gray-400 leading-relaxed mb-4 text-lg">
                  {article.excerpt}
                </p>

                <div class="flex items-center justify-between">
                  <div class="flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400">
                    <span class="flex items-center space-x-1">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                      </svg>
                      <span>{article.claps_count || 0}</span>
                    </span>
                    <button class="flex items-center space-x-1 hover:text-gray-700 dark:hover:text-gray-300">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
                      </svg>
                    </button>
                  </div>
                  
                  <div class="flex gap-2">
                    {(article.tags || []).slice(0, 2).map(tag => (
                      <span class="px-3 py-1 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 rounded-full text-sm">
                        {tag}
                      </span>
                    ))}
                  </div>
                </div>
              </article>
            )) : (
              <div class="text-center py-12">
                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">
                  No articles yet
                </h3>
                <p class="text-gray-600 dark:text-gray-400 mb-6">
                  Be the first to share your story with the world.
                </p>
                <a href="/write" class="bg-gray-900 dark:bg-white text-white dark:text-gray-900 px-6 py-3 rounded-full font-medium hover:bg-gray-800 dark:hover:bg-gray-100 transition-colors">
                  Write your first article
                </a>
              </div>
            )}
          </div>

          <!-- Sidebar -->
          <div class="lg:col-span-1">
            <div class="sticky top-24 space-y-8">
              <!-- Trending -->
              <div>
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                  Trending on FastBlog
                </h3>
                <div class="space-y-4">
                  {[1, 2, 3].map(i => (
                    <div class="flex space-x-3">
                      <span class="text-2xl font-bold text-gray-300 dark:text-gray-600">
                        0{i}
                      </span>
                      <div class="flex-1">
                        <div class="flex items-center space-x-2 mb-1">
                          <div class="w-4 h-4 bg-gray-300 dark:bg-gray-600 rounded-full"></div>
                          <span class="text-xs text-gray-600 dark:text-gray-400">
                            Author Name
                          </span>
                        </div>
                        <h4 class="text-sm font-medium text-gray-900 dark:text-white leading-tight">
                          Sample trending article title goes here
                        </h4>
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              <!-- Topics -->
              <div>
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                  Recommended topics
                </h3>
                <div class="flex flex-wrap gap-2">
                  {['Technology', 'Programming', 'Design', 'Writing', 'Startup'].map(topic => (
                    <span class="px-3 py-1 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-full text-sm hover:bg-gray-200 dark:hover:bg-gray-700 cursor-pointer">
                      {topic}
                    </span>
                  ))}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</Layout>